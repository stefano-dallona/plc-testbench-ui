/*!
 * wavesurfer.js spectrogram plugin 6.6.1 (2023-03-18)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==typeof exports?exports.WaveSurfer=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.spectrogram=t())}(self,(()=>(()=>{"use strict";var e={325:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,a,r){switch(this.bufferSize=e,this.sampleRate=t,this.bandwidth=2/e*(t/2),this.sinTable=new Float32Array(e),this.cosTable=new Float32Array(e),this.windowValues=new Float32Array(e),this.reverseTable=new Uint32Array(e),this.peakBand=0,this.peak=0,a){case"bartlett":for(s=0;s<e;s++)this.windowValues[s]=2/(e-1)*((e-1)/2-Math.abs(s-(e-1)/2));break;case"bartlettHann":for(s=0;s<e;s++)this.windowValues[s]=.62-.48*Math.abs(s/(e-1)-.5)-.38*Math.cos(2*Math.PI*s/(e-1));break;case"blackman":for(r=r||.16,s=0;s<e;s++)this.windowValues[s]=(1-r)/2-.5*Math.cos(2*Math.PI*s/(e-1))+r/2*Math.cos(4*Math.PI*s/(e-1));break;case"cosine":for(s=0;s<e;s++)this.windowValues[s]=Math.cos(Math.PI*s/(e-1)-Math.PI/2);break;case"gauss":for(r=r||.25,s=0;s<e;s++)this.windowValues[s]=Math.pow(Math.E,-.5*Math.pow((s-(e-1)/2)/(r*(e-1)/2),2));break;case"hamming":for(s=0;s<e;s++)this.windowValues[s]=.54-.46*Math.cos(2*Math.PI*s/(e-1));break;case"hann":case void 0:for(s=0;s<e;s++)this.windowValues[s]=.5*(1-Math.cos(2*Math.PI*s/(e-1)));break;case"lanczoz":for(s=0;s<e;s++)this.windowValues[s]=Math.sin(Math.PI*(2*s/(e-1)-1))/(Math.PI*(2*s/(e-1)-1));break;case"rectangular":for(s=0;s<e;s++)this.windowValues[s]=1;break;case"triangular":for(s=0;s<e;s++)this.windowValues[s]=2/e*(e/2-Math.abs(s-(e-1)/2));break;default:throw Error("No such window function '"+a+"'")}var s,i=1,n=e>>1;for(;i<e;){for(s=0;s<i;s++)this.reverseTable[s+i]=this.reverseTable[s]+n;i<<=1,n>>=1}for(s=0;s<e;s++)this.sinTable[s]=Math.sin(-Math.PI/s),this.cosTable[s]=Math.cos(-Math.PI/s);this.calculateSpectrum=function(e){var t,a,r,s=this.bufferSize,i=this.cosTable,n=this.sinTable,o=this.reverseTable,l=new Float32Array(s),h=new Float32Array(s),c=2/this.bufferSize,f=Math.sqrt,u=new Float32Array(s/2),p=Math.floor(Math.log(s)/Math.LN2);if(Math.pow(2,p)!==s)throw"Invalid buffer size, must be a power of 2.";if(s!==e.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+s+" Buffer Size: "+e.length;for(var v,d,w,m,y,b,g,M,k=1,x=0;x<s;x++)l[x]=e[o[x]]*this.windowValues[o[x]],h[x]=0;for(;k<s;){v=i[k],d=n[k],w=1,m=0;for(var S=0;S<k;S++){for(x=S;x<s;)b=w*l[y=x+k]-m*h[y],g=w*h[y]+m*l[y],l[y]=l[x]-b,h[y]=h[x]-g,l[x]+=b,h[x]+=g,x+=k<<1;w=(M=w)*v-m*d,m=M*d+m*v}k<<=1}x=0;for(var T=s/2;x<T;x++)(r=c*f((t=l[x])*t+(a=h[x])*a))>this.peak&&(this.peakBand=x,this.peak=r),u[x]=r;return u}},e.exports=t.default},943:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=a(325))&&r.__esModule?r:{default:r};function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(s=r.key,n=void 0,n=function(e,t){if("object"!==i(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"),"symbol"===i(n)?n:String(n)),r)}var s,n}var o=function(){function e(t,a){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.wavesurfer=a,this.util=a.util,this.frequenciesDataUrl=t.frequenciesDataUrl,this._onScroll=function(e){r.updateScroll(e)},this._onRender=function(){r.render()},this._onZoom=function(){r.stretchCanvases()},this._onWrapperClick=function(e){r._wrapperClickHandler(e)},this._onReady=function(){var e=r.drawer=a.drawer;if(r.container="string"==typeof t.container?document.querySelector(t.container):t.container,!r.container)throw Error("No container for WaveSurfer spectrogram");if(t.colorMap){if(t.colorMap.length<256)throw new Error("Colormap must contain 256 elements");for(var s=0;s<t.colorMap.length;s++){if(4!==t.colorMap[s].length)throw new Error("ColorMap entries must contain 4 values")}r.colorMap=t.colorMap}else{r.colorMap=[];for(var i=0;i<256;i++){var n=(255-i)/256;r.colorMap.push([n,n,n,1])}}r.width=e.width,r.pixelRatio=r.params.pixelRatio||a.params.pixelRatio,r.fftSamples=r.params.fftSamples||a.params.fftSamples||512,r.height=r.params.height||r.fftSamples/2,r.noverlap=t.noverlap,r.windowFunc=t.windowFunc,r.alpha=t.alpha,r.splitChannels=t.splitChannels,r.channels=r.splitChannels?a.backend.buffer.numberOfChannels:1,r.canvases=[],r.canvasesTimeouts=[],r.scrollLeftTracker=0,r.frequencyMin=t.frequencyMin||0,r.frequencyMax=t.frequencyMax||12e3,r.createWrapper(),r.addCanvas(),r.render(),e.wrapper.addEventListener("scroll",r._onScroll),a.on("zoom",r._onZoom),a.on("redraw",r._onRender)}}var t,a,r;return t=e,r=[{key:"create",value:function(t){return{name:"spectrogram",deferInit:!(!t||!t.deferInit)&&t.deferInit,params:t,staticProps:{FFT:s.default},instance:e}}}],(a=[{key:"init",value:function(){this.wavesurfer.isReady?this._onReady():this.wavesurfer.once("ready",this._onReady)}},{key:"destroy",value:function(){this.unAll(),this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("redraw",this._onRender),this.drawer&&this.drawer.wrapper.removeEventListener("scroll",this._onScroll),this.wavesurfer=null,this.util=null,this.params=null,this.wrapper&&(this.wrapper.removeEventListener("click",this._onWrapperClick),this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)}},{key:"createWrapper",value:function(){var e=this.container.querySelector("spectrogram");e&&this.container.removeChild(e);var t=this.wavesurfer.params;if(this.wrapper=document.createElement("spectrogram"),this.params.labels){var a=this.labelsEl=document.createElement("canvas");a.classList.add("spec-labels"),this.drawer.style(a,{position:"absolute",zIndex:9,height:"".concat(this.height*this.channels,"px"),width:"55px"}),this.wrapper.appendChild(a),this.loadLabels("rgba(68,68,68,0.5)","12px","10px","","#fff","#f7f7f7","center","#specLabels")}this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:"".concat(this.height*this.channels,"px")}),(t.fillParent||t.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.container.appendChild(this.wrapper),this.wrapper.addEventListener("click",this._onWrapperClick)}},{key:"_wrapperClickHandler",value:function(e){e.preventDefault();var t="offsetX"in e?e.offsetX:e.layerX;this.fireEvent("click",t/this.width||0)}},{key:"addCanvas",value:function(){var e=this.wrapper.appendChild(document.createElement("canvas"));this.util.style(e,{position:"absolute",zIndex:4}),this.canvases.push(e),this.canvasesTimeouts.push(null)}},{key:"removeCanvas",value:function(){clearTimeout(this.canvasesTimeouts[this.canvasesTimeouts.length-1]);var e=this.canvases[this.canvases.length-1];e.parentElement.removeChild(e),this.canvases.pop(),this.canvasesTimeouts.pop()}},{key:"updateCanvases",value:function(){for(var e=Math.ceil(this.width/4e3);this.canvases.length<e;)this.addCanvas();for(;this.canvases.length>e;)this.removeCanvas()}},{key:"render",value:function(){this.updateCanvasStyle(),this.frequenciesDataUrl?this.loadFrequenciesData(this.frequenciesDataUrl):this.getFrequencies(this.drawSpectrogram)}},{key:"updateCanvasStyle",value:function(){this.updateCanvases();for(var e=0;e<this.canvases.length;e++)this.canvases[e].width=Math.round(this.width/this.canvases.length),this.canvases[e].height=this.fftSamples/2*this.channels,this.canvases[e].style.width=Math.round(this.canvases[e].width/this.pixelRatio)+"px",this.canvases[e].style.height=this.height+"px"}},{key:"drawSpectrogram",value:function(e,t){isNaN(e[0][0])||(e=[e]),t.updateCanvasStyle();for(var a=0;a<t.canvasesTimeouts.length;a++)clearTimeout(t.canvasesTimeouts[a]);for(var r=[t.scrollLeftTracker,t.scrollLeftTracker+t.wrapper.clientWidth],s=0;s<t.canvases.length;s++){var i=s*Math.floor(t.width/t.canvases.length/t.pixelRatio),n=[i,(s+1)*Math.floor(t.width/t.canvases.length/t.pixelRatio)];t.canvases[s].style.left=i+"px";var o=0;if(n[0]>r[1]){var l=n[0]-r[1];o=Math.ceil(l/(r[1]-r[0]))}else if(n[1]<r[0]){var h=r[0]-n[1];o=Math.ceil(h/(r[1]-r[0]))}t.canvasesTimeouts[s]=setTimeout(t.drawToCanvas,25*o,e,t,s)}}},{key:"drawToCanvas",value:function(e,t,a){for(var r=t.fftSamples/2,s=t.buffer.sampleRate/2,i=t.frequencyMin,n=t.frequencyMax,o=function(o){for(var l=e[o].slice(a*Math.round(e[o].length/t.canvases.length),(a+1)*Math.round(e[o].length/t.canvases.length)),h=t.resample(l),c=new ImageData(h.length,r),f=0;f<h.length;f++)for(var u=0;u<h[f].length;u++){var p=t.colorMap[h[f][u]],v=4*((r-u)*c.width+f);c.data[v]=255*p[0],c.data[v+1]=255*p[1],c.data[v+2]=255*p[2],c.data[v+3]=255*p[3]}createImageBitmap(c).then((function(e){t.canvases[a]&&t.canvases[a].getContext("2d").drawImage(e,0,r*(1-n/s),c.width,r*(n-i)/s,0,r*o,t.canvases[a].width,r)}))},l=0;l<e.length;l++)o(l);t.canvasesTimeouts[a]=null}},{key:"getFrequencies",value:function(e){var t=this.fftSamples,a=this.buffer=this.wavesurfer.backend.buffer,r=this.channels;if(a){var i=a.sampleRate,n=[],o=this.noverlap;if(!o){var l=a.length/this.width;o=Math.max(0,Math.round(t-l))}for(var h=new s.default(t,i,this.windowFunc,this.alpha),c=0;c<r;c++){for(var f=a.getChannelData(c),u=[],p=0;p+t<f.length;){var v=f.slice(p,p+t),d=h.calculateSpectrum(v),w=new Uint8Array(t/2),m=void 0;for(m=0;m<t/2;m++)w[m]=Math.max(-255,45*Math.log10(d[m]));u.push(w),p+=t-o}n.push(u)}e(n,this)}else this.fireEvent("error","Web Audio buffer is not available")}},{key:"loadFrequenciesData",value:function(e){var t=this,a=this.util.fetchFile({url:e});return a.on("success",(function(e){return t.drawSpectrogram(JSON.parse(e),t)})),a.on("error",(function(e){return t.fireEvent("error",e)})),a}},{key:"freqType",value:function(e){return e>=1e3?(e/1e3).toFixed(1):Math.round(e)}},{key:"unitType",value:function(e){return e>=1e3?"KHz":"Hz"}},{key:"loadLabels",value:function(e,t,a,r,s,i,n,o){e=e||"rgba(68,68,68,0)",t=t||"12px",a=a||"10px",r=r||"Helvetica",s=s||"#fff",i=i||"#fff",n=n||"center",o=o||"#specLabels";var l=this.height||512,h=l/256*5,c=this.frequencyMin,f=(this.frequencyMax-c)/h,u=this.labelsEl.getContext("2d"),p=window.devicePixelRatio;if(this.labelsEl.height=this.height*this.channels*p,this.labelsEl.width=55*p,u.scale(p,p),u)for(var v=0;v<this.channels;v++){u.fillStyle=e,u.fillRect(0,v*l,55,(1+v)*l),u.fill();var d=void 0;for(d=0;d<=h;d++){u.textAlign=n,u.textBaseline="middle";var w=c+f*d,m=this.freqType(w),y=this.unitType(w),b=void 0;0==d?(b=(1+v)*l+d-10,u.fillStyle=i,u.font=a+" "+r,u.fillText(y,40,b),u.fillStyle=s,u.font=t+" "+r,u.fillText(m,16,b)):(b=(1+v)*l-50*d+2,u.fillStyle=i,u.font=a+" "+r,u.fillText(y,40,b),u.fillStyle=s,u.font=t+" "+r,u.fillText(m,16,b))}}}},{key:"updateScroll",value:function(e){this.wrapper&&(this.scrollLeftTracker=e.target.scrollLeft,this.wrapper.scrollLeft=e.target.scrollLeft)}},{key:"resample",value:function(e){var t,a=e.length,r=[],s=1/e.length,i=1/a;for(t=0;t<a;t++){var n=new Array(e[0].length),o=void 0;for(o=0;o<e.length;o++){var l=o*s,h=l+s,c=t*i,f=c+i,u=h<=c||f<=l?0:Math.min(Math.max(h,c),Math.max(f,l))-Math.max(Math.min(h,c),Math.min(f,l)),p=void 0;if(u>0)for(p=0;p<e[0].length;p++)null==n[p]&&(n[p]=0),n[p]+=u/i*e[o][p]}var v=new Uint8Array(e[0].length),d=void 0;for(d=0;d<e[0].length;d++)v[d]=n[d];r.push(v)}return r}},{key:"stretchCanvases",value:function(){for(var e=0;e<this.canvases.length;e++){this.canvases[e].style.width=Math.round(this.drawer.width/this.canvases.length/this.pixelRatio)+"px";var t=e*Math.floor(this.drawer.width/this.canvases.length/this.pixelRatio);this.canvases[e].style.left=t+"px"}}}])&&n(t.prototype,a),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=o,e.exports=t.default}},t={};var a=function a(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,a),i.exports}(943);return a})()));
//# sourceMappingURL=wavesurfer.spectrogram.min.js.map